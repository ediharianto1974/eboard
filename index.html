<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>e-Board -- Phonics Master</title>
  <style>
    :root {
      --primary: #3b82f6;
      --success: #22c55e;
      --danger: #ef4444;
      --warning: #f59e0b;
      --bg-light: rgba(255, 255, 255, 0.95);
    }

    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      padding: 10px;
      background: #f0f2f5 url("background.gif") no-repeat center center fixed;
      background-size: cover;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    header { 
      font-size: 1.8rem; 
      font-weight: bold; 
      text-align: center;
      margin: 5px 0;
      color: #1e293b;
    }

    #levelBadge {
      background: var(--warning);
      color: white;
      padding: 4px 15px;
      border-radius: 20px;
      font-size: 1rem;
      display: inline-block;
      margin-bottom: 10px;
    }

    #topbar { 
      display: flex; 
      justify-content: space-between; 
      max-width: 900px; 
      margin: 0 auto; 
      width: 100%;
      font-weight: bold;
    }

    #progressContainer {
      width: 100%;
      max-width: 900px;
      margin: 5px auto;
      background: #e5e7eb;
      border-radius: 20px;
      height: 10px;
    }

    #progressBar {
      width: 0%;
      height: 100%;
      background: linear-gradient(90deg, var(--success), var(--primary));
      border-radius: 20px;
      transition: width 0.3s;
    }

    #gameArea {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      gap: 40px;
      max-width: 1000px;
      margin: auto;
      background: var(--bg-light);
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }

    .visual-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }

    #imagePlaceholder {
      width: 250px;
      height: 250px;
      border: 4px solid #3b82f6;
      border-radius: 20px;
      background: white;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }

    #image { max-width: 90%; max-height: 90%; object-fit: contain; }

    .interaction-section {
      flex: 1.5;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #word { 
      font-size: 3.5rem; 
      margin: 0 0 15px 0; 
      letter-spacing: 8px; 
      font-weight: bold;
      color: #334155;
    }

    #choices { 
      display: grid; 
      grid-template-columns: repeat(3, 1fr); 
      gap: 10px; 
      width: 100%;
    }

    .choice { 
      background: white; 
      border-radius: 12px; 
      padding: 15px 5px; 
      cursor: pointer; 
      font-size: 1.5rem; 
      font-weight: bold;
      border: 2px solid #cbd5e1;
      box-shadow: 0 4px 0 #cbd5e1;
      text-align: center;
    }

    .choice:hover { background: #f1f5f9; }
    .choice.correct { background: var(--success) !important; color: white; border-color: #16a34a; box-shadow: 0 4px 0 #16a34a; }
    .choice.wrong { background: var(--danger) !important; color: white; border-color: #dc2626; box-shadow: 0 4px 0 #dc2626; }

    #nextBtn { 
      margin-top: 20px;
      padding: 12px 40px; 
      font-size: 1.1rem; 
      border: none; 
      border-radius: 50px; 
      background: var(--primary); 
      color: white; 
      cursor: pointer; 
      font-weight: bold;
      display: none;
    }

    #resultBox {
      background: white;
      padding: 30px;
      border-radius: 25px;
      max-width: 600px;
      margin: auto;
      display: none;
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
    }

    .btn-sound {
      background: #8b5cf6; border: none; border-radius: 50%;
      width: 60px; height: 60px; cursor: pointer; color: white;
      font-size: 1.5rem; box-shadow: 0 4px 0 #7c3aed;
    }

    @media (max-width: 768px) {
      #gameArea { flex-direction: column; gap: 10px; overflow-y: auto; height: auto; }
      #imagePlaceholder { width: 180px; height: 180px; }
    }
  </style>
</head>
<body>

  <header>e-Board: Phonics Master</header>
  <div style="text-align: center;"><div id="levelBadge">Level 1</div></div>

  <div id="topbar">
    <div id="points">Total Points: 0</div>
    <div id="counter">Q: 1 / 4</div>
  </div>

  <div id="progressContainer"><div id="progressBar"></div></div>

  <div id="gameArea">
    <div class="visual-section">
      <div id="imagePlaceholder">
        <img id="image" src="" alt="Word Visual">
      </div>
      <button id="soundBtn" class="btn-sound">üîä</button>
    </div>

    <div class="interaction-section">
      <div id="word">__</div>
      <div id="choices"></div>
      <div id="feedback" style="height: 30px; font-weight: bold; margin: 10px; font-size: 1.1rem;"></div>
      <button id="nextBtn">Next Question ‚û°Ô∏è</button>
    </div>
  </div>

  <div id="resultBox">
    <div id="resultContent"></div>
    <button onclick="restartGame()" style="margin-top:20px; padding:12px 25px; cursor:pointer; border-radius:12px; border:none; background:var(--primary); color:white; font-weight:bold;">üîÑ RESTART GAME</button>
  </div>

  <audio id="correctSound" src="correct.mp3"></audio>
  <audio id="wrongSound" src="wrong.mp3"></audio>
  <audio id="wordSound"></audio>
  <audio id="bgMusic" src="bmusic.mp3" loop></audio>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/dist/confetti.browser.min.js"></script>
<script>
  const levels = {
    1: { name: "Level 1: L-Blends", choices: ["BL", "CL", "FL", "GL", "PL", "SL"],
         data: [{word: "__UE", answer: "GL", image: "glue.jpg", sound: "glue.mp3"}, {word: "__AP", answer: "CL", image: "clap.jpg", sound: "clap.mp3"}, {word: "__ANE", answer: "PL", image: "plane.jpg", sound: "plane.mp3"}, {word: "__ONDE", answer: "BL", image: "blonde.jpg", sound: "blonde.mp3"}] },
    2: { name: "Level 2: R-Blends", choices: ["BR", "CR", "DR", "FR", "GR", "TR"],
         data: [{word: "__AGON", answer: "DR", image: "dragon.jpg", sound: "dragon.mp3"}, {word: "__EE", answer: "TR", image: "tree.jpg", sound: "tree.mp3"}, {word: "__UIT", answer: "FR", image: "fruit.jpg", sound: "fruit.mp3"}, {word: "__USH", answer: "BR", image: "brush.jpg", sound: "brush.mp3"}] },
    3: { name: "Level 3: Master Mix", choices: ["DR", "TR", "FL", "GR", "CR", "BR", "PR", "PL"],
         data: [{word: "__EY", answer: "GR", image: "grey.jpg", sound: "grey.mp3"}, {word: "__AYON", answer: "CR", image: "crayon.jpg", sound: "crayon.mp3"}, {word: "__ETTY", answer: "PR", image: "pretty.jpg", sound: "pretty.mp3"}, {word: "__Y", answer: "FL", image: "fly.jpg", sound: "fly.mp3"}] }
  };

  let currentLevel = 1;
  let totalScore = 0;
  let correctInLevel = 0; // Tracks performance for the current level
  let currentIndex = 0;
  let levelQuestions = [];

  const els = {
    img: document.getElementById("image"),
    word: document.getElementById("word"),
    points: document.getElementById("points"),
    choices: document.getElementById("choices"),
    counter: document.getElementById("counter"),
    nextBtn: document.getElementById("nextBtn"),
    progress: document.getElementById("progressBar"),
    resultBox: document.getElementById("resultBox"),
    gameArea: document.getElementById("gameArea"),
    feedback: document.getElementById("feedback"),
    lvlBadge: document.getElementById("levelBadge")
  };

  function stopAllSounds() {
    const sounds = ['correctSound', 'wrongSound', 'wordSound'];
    sounds.forEach(id => {
      const s = document.getElementById(id);
      s.pause();
      s.currentTime = 0;
    });
  }

  function startGame() {
    levelQuestions = [...levels[currentLevel].data].sort(() => Math.random() - 0.5);
    els.lvlBadge.textContent = levels[currentLevel].name;
    currentIndex = 0;
    correctInLevel = 0; // Reset level performance
    loadQuestion();
  }

  function loadQuestion() {
    stopAllSounds();
    const q = levelQuestions[currentIndex];
    els.img.src = q.image;
    els.word.textContent = q.word;
    els.feedback.textContent = "";
    els.counter.textContent = `Q: ${currentIndex + 1} / ${levelQuestions.length}`;
    els.nextBtn.style.display = "none";
    document.getElementById("wordSound").src = q.sound;
    
    updateProgressBar();
    renderChoices();
  }

  function renderChoices() {
    els.choices.innerHTML = "";
    levels[currentLevel].choices.forEach(c => {
      const btn = document.createElement("div");
      btn.className = "choice";
      btn.textContent = c;
      btn.onclick = () => checkAnswer(btn, c);
      els.choices.appendChild(btn);
    });
  }

  function checkAnswer(selectedBtn, choice) {
    const q = levelQuestions[currentIndex];
    const isCorrect = (choice === q.answer);
    const fullWord = q.word.replace("__", q.answer);

    if (isCorrect) {
      totalScore += 10;
      correctInLevel++; // Count this for level advancement
      els.points.textContent = `Total Points: ${totalScore}`;
      els.feedback.textContent = "‚ú® Correct!";
      els.feedback.style.color = "var(--success)";
      selectedBtn.classList.add("correct");
      document.getElementById("correctSound").play();
    } else {
      els.feedback.textContent = `‚ùå Incorrect!`;
      els.feedback.style.color = "var(--danger)";
      selectedBtn.classList.add("wrong");
      document.getElementById("wrongSound").play();
      
      Array.from(els.choices.children).forEach(btn => {
        if(btn.textContent === q.answer) btn.classList.add("correct");
      });
    }

    els.word.textContent = fullWord;
    Array.from(els.choices.children).forEach(btn => btn.style.pointerEvents = "none");
    els.nextBtn.style.display = "block";
  }

  els.nextBtn.onclick = () => {
    stopAllSounds(); // Stop clapping/feedback sound immediately
    currentIndex++;

    if (currentIndex < levelQuestions.length) {
      loadQuestion();
    } else {
      // Level is finished, check if student passed (needs at least 3 correct)
      if (correctInLevel >= 3) {
        if (currentLevel < 3) {
          currentLevel++;
          alert(`Great Job! You passed ${levels[currentLevel-1].name}. Get ready for Level ${currentLevel}!`);
          startGame();
        } else {
          showResult();
        }
      } else {
        // Failed the level
        alert(`Level Failed! You only got ${correctInLevel}/4 correct. You need at least 3 to pass. Try this level again!`);
        totalScore -= (correctInLevel * 10); // Optionally reset points for this level
        els.points.textContent = `Total Points: ${totalScore}`;
        startGame(); // Restarts the same level
      }
    }
  };

  function updateProgressBar() {
    let totalQ = 12;
    let completed = ((currentLevel - 1) * 4) + currentIndex;
    els.progress.style.width = `${(completed / totalQ) * 100}%`;
  }

  function showResult() {
    els.gameArea.style.display = "none";
    els.resultBox.style.display = "block";
    els.progress.style.width = "100%";
    document.getElementById("resultContent").innerHTML = `
      <h2>Perfect! Game Completed!</h2>
      <h3>Final Score: ${totalScore} Points</h3>
      <p>Excellent work, Phonics Master!</p>
    `;
    // Confetti only on final win
    confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
  }

  function restartGame() {
    currentLevel = 1;
    totalScore = 0;
    els.points.textContent = `Total Points: 0`;
    els.gameArea.style.display = "flex";
    els.resultBox.style.display = "none";
    startGame();
  }

  document.getElementById("soundBtn").onclick = () => document.getElementById("wordSound").play();
  
  startGame();
</script>
</body>
</html>
